# Global defaults shared by all releases.
global:
  # Ingress host/protocol used to build URLs.
  domain: localhost
  protocol: http
  # Shared ServiceAccount name for gfs-user + logs collector.
  gfsUser:
    username: gfs-user
  # Shared ingress subpaths (kebab-case keys).
  paths:
    grafana: /grafana
    # Use camelCase keys to match vendored Victoria charts.
    victoriaMetrics: /victoria-metrics
    victoriaLogs: /victoria-logs
    victoriaTraces: /victoria-traces
    vmagent: /vmagent
  # Shared service ports (camelCase keys).
  ports:
    grafana: 3000
    # Use camelCase keys to match vendored Victoria charts.
    victoriaMetrics: 8428
    victoriaLogs: 9428
    victoriaTraces: 9410
    # OTLP gRPC port for victoria-traces (ingestion).
    victoriaTracesOtlpGrpc: 4317
    vmagent: 8429
  # Optional imagePullSecrets applied to all charts that support it.
  imagePullSecrets: []
  scrapers:
    # Optional global scrape targets for vmagent.
    # Leave empty when using per-release vmagent.scrapeTargets.
    metricsTargets: []

# Service and scraper overrides are centralized here.
grafana:
  # Custom Grafana image with offline plugins.
  image:
    repository: limitium/grafanaplg
    tag: 11.2.0-with-vl.5
    pullPolicy: Always
  ingress:
    enabled: true
    className: nginx
  server:
    # Serve from global.paths.grafana.
    serveFromSubPath: true
  datasources:
    enabled: true
  plugins:
    - victoriametrics-logs-datasource
  persistence:
    # Override only the PVC size; other settings use chart defaults.
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-metrics:
  # VictoriaMetrics image/version.
  image:
    repository: victoriametrics/victoria-metrics
    tag: "v1.110.0"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for time series data.
    enabled: true
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-logs:
  # VictoriaLogs image/version.
  image:
    repository: victoriametrics/victoria-logs
    tag: "latest"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for logs data.
    enabled: true
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-traces:
  # VictoriaTraces image/version.
  image:
    repository: victoriametrics/victoria-traces
    tag: "latest"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for traces data.
    enabled: true
    size: 1Gi
    storageClassName: ""
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

vmagent:
  enabled: true
  # Metrics scraper image/version.
  image:
    repository: victoriametrics/vmagent
    tag: "v1.110.0"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
  # Additional scrape targets (appended to default self-monitoring jobs).
  # Default jobs (victoria-metrics, victoria-logs, victoria-traces, grafana) are always included.
  scrapeTargets:
    - job_name: demo-apps
      metrics_path: /metrics
      static_configs:
        - targets:
            # These are the default service names created by the demo-apps chart.
            - demo-apps-grafascope-demo-apps-service-a:8000
            - demo-apps-grafascope-demo-apps-service-b:8000
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-logs-collector:
  enabled: true
  # DaemonSet log collector image/version.
  image:
    registry: ""
    repository: victoriametrics/vlagent
    tag: "v1.43.1"
    variant: ""
    pullPolicy: IfNotPresent
  serviceAccount:
    # Use gfs-user ServiceAccount by default.
    create: false
    automount: true
    annotations: {}
    name: gfs-user # defaults to global.gfsUser.username when set
  remoteWrite:
    # Explicit URL to VictoriaLogs insert endpoint (includes http.pathPrefix).
    - url: "http://victoria-logs:9428/victoria-logs/insert/native"
      headers: {}
  collector:
    # Basic field mapping for log parsing.
    timeField: ["time", "ts", "timestamp"]
    msgField: ["message", "msg"]
    excludeFilter: ""
    includePodLabels: true
    includePodAnnotations: false
    includeNodeLabels: false
    includeNodeAnnotations: false
  env: []
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

gfs-user:
  # ServiceAccount + RBAC for log collectors and scrapers.
  nameOverride: ""
  fullnameOverride: ""
  serviceAccount:
    create: true
    name: gfs-user # should match global.gfsUser.username
  rbac:
    create: true
    # true => ClusterRole/ClusterRoleBinding (required if you include cluster-scoped resources like nodes/namespaces/PVs)
    # false => Role/RoleBinding (namespace-scoped; you must remove cluster-scoped resources from the list)
    clusterWide: true
    roleName: "gfs-user-role"
    bindingName: "gfs-user-binding"
    apiGroups:
      - ""
      - apps
      - autoscaling
      - batch
      - extensions
      - policy
      - rbac.authorization.k8s.io
    resources:
      - pods
      - componentstatuses
      - configmaps
      - daemonsets
      - deployments
      - deployments/scale
      - events
      - endpoints
      - horizontalpodautoscalers
      - ingress
      - jobs
      - cronjobs
      - limitranges
      - namespaces
      - nodes
      - persistentvolumes
      - persistentvolumeclaims
      - resourcequotas
      - replicasets
      - replicationcontrollers
      - serviceaccounts
      - services
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
