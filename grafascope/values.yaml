# Global defaults shared by all releases.
global:
  # Ingress host/protocol used to build URLs.
  domain: localhost
  protocol: http
  # Shared ServiceAccount name for gfs-user + logs collector.
  gfsUser:
    username: gfs-user
  # Shared ingress subpaths (kebab-case keys).
  paths:
    grafana: /grafana
    # Use kebab-case keys to match chart names.
    victoria-metrics: /victoria-metrics
    victoria-logs: /victoria-logs
    victoria-traces: /victoria-traces
    vmagent: /vmagent
  # Shared service ports (kebab-case keys).
  ports:
    grafana: 3000
    # Use kebab-case keys to match chart names.
    victoria-metrics: 8428
    victoria-logs: 9428
    victoria-traces: 9410
    vmagent: 8429
  # Optional imagePullSecrets applied to all charts that support it.
  imagePullSecrets: []
  scrapers:
    # Optional global scrape targets for vmagent.
    metricsTargets: []

# Service and scraper overrides are centralized here.
grafana:
  # Custom Grafana image with offline plugins.
  image:
    repository: limitium/grafanaplg
    tag: 11.2.0-with-vl.2
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
  server:
    # Serve from global.paths.grafana.
    serveFromSubPath: true
  datasources:
    enabled: true
  plugins:
    - victoriametrics-logs-datasource
  persistence:
    # Override only the PVC size; other settings use chart defaults.
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-metrics:
  # VictoriaMetrics image/version.
  image:
    repository: victoriametrics/victoria-metrics
    tag: "v1.110.0"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for time series data.
    enabled: true
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-logs:
  # VictoriaLogs image/version.
  image:
    repository: victoriametrics/victoria-logs
    tag: "latest"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for logs data.
    enabled: true
    size: 1Gi
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-traces:
  # VictoriaTraces image/version.
  image:
    repository: victoriametrics/victoria-traces
    tag: "latest"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
  persistence:
    # Storage for traces data.
    enabled: true
    size: 1Gi
    storageClassName: ""
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

vmagent:
  enabled: true
  # Metrics scraper image/version.
  image:
    repository: victoriametrics/vmagent
    tag: "v1.110.0"
    pullPolicy: IfNotPresent
  ingress:
    enabled: true
  # Optional per-release target overrides.
  scrapeTargets: []
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi

victoria-logs-collector:
  enabled: true
  # DaemonSet log collector image/version.
  image:
    registry: ""
    repository: victoriametrics/vlagent
    tag: "v1.43.1"
    variant: ""
    pullPolicy: IfNotPresent
  serviceAccount:
    # Use gfs-user ServiceAccount by default.
    create: false
    automount: true
    annotations: {}
    name: gfs-user # defaults to global.gfsUser.username when set
  remoteWrite:
    # When empty, URL is derived from global protocol/ports/paths.
    - url: "" # built from global protocol/ports/paths when empty
      headers: {}
  collector:
    # Basic field mapping for log parsing.
    timeField: ["time", "ts", "timestamp"]
    msgField: ["message", "msg"]
    excludeFilter: ""
    includePodLabels: true
    includePodAnnotations: false
    includeNodeLabels: false
    includeNodeAnnotations: false
  env: []
  # Centralized resources (override chart defaults).
  resources:
    requests:
      cpu: "1"
      memory: 1Gi
    limits:
      memory: 1Gi
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

gfs-user:
  # ServiceAccount + RBAC for log collectors and scrapers.
  nameOverride: ""
  fullnameOverride: ""
  serviceAccount:
    create: true
    name: gfs-user # should match global.gfsUser.username
  rbac:
    create: true
    # true => ClusterRole/ClusterRoleBinding (required if you include cluster-scoped resources like nodes/namespaces/PVs)
    # false => Role/RoleBinding (namespace-scoped; you must remove cluster-scoped resources from the list)
    clusterWide: true
    roleName: "gfs-user-role"
    bindingName: "gfs-user-binding"
    apiGroups:
      - ""
      - apps
      - autoscaling
      - batch
      - extensions
      - policy
      - rbac.authorization.k8s.io
    resources:
      - pods
      - componentstatuses
      - configmaps
      - daemonsets
      - deployments
      - deployments/scale
      - events
      - endpoints
      - horizontalpodautoscalers
      - ingress
      - jobs
      - cronjobs
      - limitranges
      - namespaces
      - nodes
      - persistentvolumes
      - persistentvolumeclaims
      - resourcequotas
      - replicasets
      - replicationcontrollers
      - serviceaccounts
      - services
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
